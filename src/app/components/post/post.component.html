<!--
<div *ngIf="ready" class="grid pb-6 lg:px-4 scalein animation-duration-200 wafrn-container">
  <div class="col-12 wafrn-post">
    <p-card>
      <div *ngIf="post.length > 1" class="center-text overflow-hidden">
        <img [routerLink]="'/blog/'+ originalPoster.url" crossorigin="anonymous" loading="lazy" [src]="avatars[avatars.length - 1]" class="avatar"/>
        <div class="w-full white-space-nowrap overflow-hidden text-overflow-ellipsis flex flex-column">
          <div>
            <a [routerLink]="'/blog/'+ originalPoster.url" [innerHTML]="originalPoster.name"></a>
          </div>
          <span class="font-small" [innerText]="originalPoster.url"></span>
        </div>
      </div>

      <div *ngFor="let content of post; index as index">
        <p-divider *ngIf="post.length > 1 && (content.content !== '' || content.tags.length)"></p-divider>
        <div *ngIf="content.content !== '' || (content.medias && content.medias.length > 0) || index == 0 || content.tags.length > 0" class="fragment-header">
          <div class="flex gap-1 md:gap-3 align-items-center" style="width: 100%;">
            <div class="center-text py-2 flex-grow-1 flex-shrink-1 min-w-0">
              <img [routerLink]="'/blog/'+ content.user.url" crossorigin="anonymous" loading="lazy" [src]="avatars[index]" class="avatar" />
              <div class="w-full overflow-hidden flex flex-column">
                <a class="max-w-full white-space-nowrap overflow-hidden text-overflow-ellipsis" [routerLink]="'/blog/'+ content.user.url" [innerHTML]="content.user.name"></a>
                <span class="font-small max-w-full white-space-nowrap overflow-hidden text-overflow-ellipsis" [innerText]="content.user.url"></span>
              </div>
            </div>
            <button
              *ngIf="followedUsers.indexOf(content.userId) === -1 && userLoggedIn"
              pButton
              pRipple
              label="Follow"
              class="w-80 p-button-sm flex-shrink-0"
              (click)="followUser(content.userId)">
            </button>
            <div class="timestamp flex-shrink-0">{{content.createdAt | date : 'shortDate'}}</div>
            <p-splitButton
              (onClick)="sharePost(content.id)"
              icon="pi pi-share-alt"
              styleClass="p-button-sm flex-shrink-0"
              [model]="buttonItems[content.id]"
              >
            </p-splitButton>
          </div>
        </div>
        <br />
        <div *ngIf="content.content_warning" class="fragment-content ql-editor -mx-3">{{content.content_warning}}</div>
        <button pButton *ngIf="content.content_warning" (click)="dismissContentWarning()" class="w-full" label="I understand this and I want to see this post"></button>
        <div
          *ngIf="content.content !== '' || content.tags.length"
          class="fragment-content ql-editor -mx-3"
          [ngClass]="{'blurry': content.content_warning}"
          [injectHTML]="content.content"
        >
        </div>
        <div
        *ngIf="content.questionPoll"
        [ngClass]="{'blurry': content.content_warning}"
        >
        <app-poll [poll]="content.questionPoll" ></app-poll>
        </div>
        <div *ngFor="let media of content.medias"  [ngClass]="{'blurry': content.content_warning}" >
          <app-wafrn-media [data]="media" ></app-wafrn-media>
        </div>
        <div *ngIf="content.tags"
        [ngClass]="{'blurry': content.content_warning}"
        >
          <a *ngFor="let tag of content.tags" [routerLink]="'/dashboard/search/' + tag.tagName" style="margin: 0.25em" >
            <p-tag class="wafrn-tag" [value]="'#' +tag.tagName"></p-tag>
          </a>
        </div>
      </div>

      <div *ngIf="!showFull">
        <p-divider></p-divider>

        <button pButton (click)="expandPost()" class="w-full" label="Expand shortened post"></button>
      </div>
      <ng-template pTemplate="footer">
        <p-divider></p-divider>

        <div class="grid">
          <div class="col-8 flex justify-content-start">
            <a [routerLink]="['/post', finalPost.id]">Notes: {{notes}}</a>
          </div>
          <div *ngIf="userLoggedIn" class="col-4 flex justify-content-end">
            <div class="grid" *ngIf="!loadingAction">
              <i
               (click)="quickReblog(finalPost.id)"
               class="col-3 pi pi-history hover-cursor" title="Quick Reblog"></i>
              <i (click)="launchReblog()" class="col-3 pi pi-reply hover-cursor" title="Reply"></i>
              <i *ngIf="showLikeFinalPost === 1" (click)="likePost(finalPost)" class="col-3 pi pi-heart hover-cursor" title="Like Post"></i>
              <i *ngIf="showLikeFinalPost === 2" (click)="unlikePost(finalPost)" class="col-3 pi pi-heart-fill hover-cursor" title="Unlike Post"></i>
              <i *ngIf="!(post[post.length - 1].userId == myId)" (click)="reportPost()" class="col-3 pi pi-exclamation-triangle hover-cursor" title="Report Post"></i>
              <i *ngIf="(post[post.length - 1].userId == myId)" (click)="deletePost(post[post.length - 1].id)" class="col-3 pi pi-trash hover-cursor" title="Delete Post"></i>
            </div>
            <div class="grid" *ngIf="loadingAction">
              <i class="pi pi-spin pi-spinner" style="height: 1em;"></i>
            </div>
          </div>
        </div>
      </ng-template>
    </p-card>
  </div>
</div>

-->

<mat-card #postElement class="p-3 mb-6 lg:mx-4 scalein wafrn-container">
  <div *ngIf="post.length > 1" class="center-text overflow-hidden">
    <div class="avatar">
      <img
        [routerLink]="'/blog/' + originalPoster.url"
        crossorigin="anonymous"
        loading="lazy"
        [src]="avatars[avatars.length - 1]"
        [alt]="originalPoster.url + ' avatar'"
        width="40"
        height="40"
      />
    </div>
    <div
      class="w-full white-space-nowrap overflow-hidden text-overflow-ellipsis flex flex-column"
    >
      <div>
        <a
          [routerLink]="'/blog/' + originalPoster.url"
          [innerHTML]="originalPoster.name"
        ></a>
      </div>
      <span class="font-small" [innerText]="originalPoster.url"></span>
    </div>
  </div>
  @for (content of post; track post; let index = $index) {
  <hr
    *ngIf="post.length > 1 && (content.content !== '' || content.tags.length)"
  />
  <div
    *ngIf="
      content.content !== '' ||
      (content.medias && content.medias.length > 0) ||
      index === 0 ||
      content.tags.length > 0
    "
    id="fragment"
  >
    <div
      id="fragment-header"
      class="flex gap-1 md:gap-3 align-items-center"
      style="width: 100%"
    >
      <div class="center-text py-2 flex-grow-1 flex-shrink-1 min-w-0">
        <div class="avatar">
          <img
            [alt]="content.user.url + ' avatar'"
            [routerLink]="'/blog/' + content.user.url"
            crossorigin="anonymous"
            loading="lazy"
            [src]="avatars[index]"
            height="40"
            width="40"
          />
        </div>
        <div class="w-full overflow-hidden flex flex-column">
          <a
            class="max-w-full white-space-nowrap overflow-hidden text-overflow-ellipsis"
            [routerLink]="'/blog/' + content.user.url"
            [innerHTML]="content.user.name"
          ></a>
          <span
            class="font-small max-w-full white-space-nowrap overflow-hidden text-overflow-ellipsis"
            [innerText]="content.user.url"
          ></span>
        </div>
      </div>
      <button
        mat-flat-button
        color="primary"
        *ngIf="followedUsers.indexOf(content.userId) === -1 && userLoggedIn"
        class="w-80 p-button-sm flex-shrink-0"
        (click)="followUser(content.userId)"
      >
        Follow
      </button>
      <div class="timestamp flex-shrink-0">
        {{ content.createdAt | date : "shortDate" }}
      </div>
      <div class="gap-0">
        <button
          mat-raised-button
          color="primary"
          class="split-button-left"
          (click)="sharePost(content.id)"
        >
          <fa-icon [icon]="shareIcon"></fa-icon>
        </button>
        <button
          mat-raised-button
          color="primary"
          class="split-button-right"
          [matMenuTriggerFor]="menu"
        >
          <fa-icon [icon]="expandDownIcon"></fa-icon>
        </button>
      </div>
      <mat-menu #menu="matMenu" xPosition="before">
        <button (click)="sharePost(content.id)" mat-menu-item>
          <fa-icon class="mr-2" [icon]="shareIcon"></fa-icon>Share with wafrn
        </button>
        <button (click)="shareOriginalPost(content.remotePostId)" mat-menu-item>
          <fa-icon class="mr-2" [icon]="shareExternalIcon"></fa-icon>Share
          external URL
        </button>
        @if(userLoggedIn) {
        <button (click)="replyPost(content)" mat-menu-item>
          <fa-icon class="mr-2" [icon]="reblogIcon"></fa-icon>Reblog
        </button>
        <button (click)="quickReblog(content.id)" mat-menu-item>
          <fa-icon class="mr-2" [icon]="quickReblogIcon"></fa-icon>Quick reblog
        </button>
        @if(content.userId !== myId){ @if
        (content.userLikesPostRelations.includes(myId)) {
        <button (click)="unlikePost(content)" mat-menu-item>
          <fa-icon class="mr-2" [icon]="clearHeartIcon"></fa-icon>Dislike post
        </button>
        } @else {
        <button (click)="likePost(content)" mat-menu-item>
          <fa-icon class="mr-2" [icon]="solidHeartIcon"></fa-icon>Like post
        </button>
        } }
        <button (click)="reportPost(content)" mat-menu-item>
          <fa-icon class="mr-2" [icon]="reportIcon"></fa-icon>Report post
        </button>
        }
      </mat-menu>
    </div>
    <div id="fragment-content-warning" *ngIf="content.content_warning">
      <div class="fragment-content ql-editor -mx-3">
        {{ content.content_warning }}
      </div>
      <button
        mat-flat-button
        color="primary"
        (click)="dismissContentWarning()"
        class="w-full"
      >
        I understand this and I want to see this post
      </button>
    </div>
    <div
      id="fragment-content"
      *ngIf="content.content !== '' || content.tags.length"
      class="fragment-content ql-editor -mx-3"
      [ngClass]="{ blurry: content.content_warning }"
      [injectHTML]="content.content"
    ></div>
    <div
      id="fragment-polls"
      *ngIf="content.questionPoll"
      [ngClass]="{ blurry: content.content_warning }"
    >
      <app-poll [poll]="content.questionPoll"></app-poll>
    </div>
    <div
      id="fragment-medias"
      *ngFor="let media of content.medias"
      [ngClass]="{ blurry: content.content_warning }"
    >
      <app-wafrn-media [data]="media"></app-wafrn-media>
    </div>
    <div
      id="fragment-tags"
      *ngIf="content.tags && content.tags.length"
      [ngClass]="{ blurry: content.content_warning }"
    >
      @for(tag of content.tags; track tag) {
      <a
        [routerLink]="'/dashboard/search/' + tag.tagName"
        style="margin: 0.25em"
      >
        <span>#{{ tag.tagName }}</span>
      </a>
      }
    </div>
  </div>
  <hr [id]="'final-hr-' + finalPost.id" />
  <div class="grid">
    <div class="col-8 flex justify-content-start">
      <a [routerLink]="'/post/' + finalPost.id">Notes: {{ notes }}</a>
    </div>
    <div *ngIf="userLoggedIn" class="col-4 flex justify-content-end">
      <div class="grid" *ngIf="!loadingAction">ACTIONS</div>
    </div>
  </div>
  }
</mat-card>
